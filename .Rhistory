source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_EvalAllModelsFunctions.R", echo=TRUE)
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_RunCrossValidationFunctions.R", echo=TRUE)
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_RunCrossValidationFunctions.R", echo=TRUE)
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_RunCrossValidationFunctions.R", echo=TRUE)
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdlB_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_EvalAllModelsFunctions.R", echo=TRUE)
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
stringr::str_starts("Tweedie(1.95)","Tweedie")
stringr::str_starts("bin","Tweedie")
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/r_LogLikeFunctions.R", echo=TRUE)
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdlB_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=2,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
View(dfrCrsVal)
require(DHARMa);
require(dplyr);
require(ggplot2);
require(gratia)
require(mgcv);
#--get censored data and prediction grids----
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path);
lst = wtsUtilities::getObj(file.path(dirThs,"rda_Step3a.CensoredDataAndGridsList.Males.RData"));
#--remove zeros, infs, questionable observed Rs----
dfrDatp   = lst$dfrDat |> dplyr::filter(obsR<10, is.finite(lnR),between(z,15,150));
#dfrDatp   = lst$dfrDat |> dplyr::filter(between(z,15,150));
#--TWEEDIE (using mgcv::tw) regression  models for lnR----
famTW = mgcv::tw(link="log");
#--------ALL Z 2-WAY INTERACTIONS--------------------------
#--ln(r) = ti(z) +
#--         ti(d) + ti(t) + ti(f) + ti(s) +
#--        ti(z,d) + ti(z,t) + ti(z,f) +ti(z,s)
ks=c(20,10);
k1 = ks[1]; k2 = ks[2];
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2)   + ti(f,bs="ts",k=k2)   + ti(s,bs="ts",k=k2) +
ti(z,d,bs="ts",k=c(k1,k2)) + ti(z,t,bs="ts",k=c(k1,k2)) + ti(z,f,bs="ts",k=c(k1,k2)) + ti(z,s,bs="ts",k=c(k1,k2));
# frmla  = obsR~ti(z,bs="ts",k=k1)   +
#            ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdl_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
#--run cross validation-------------------------------------------------
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdl_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
wtsUtilities::saveObj(dfrCrsVal,file.path(dirThs,"rda_Step3b1.TweedieModels_CrsVal.RData"));
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/CrossVal_Males")
#--fit various models for obsR using mgcv to fit GAMs for males using the TWEEDIE distribution----
require(DHARMa);
require(dplyr);
require(ggplot2);
require(gratia)
require(mgcv);
#--get censored data and prediction grids----
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path);
lst = wtsUtilities::getObj(file.path(dirThs,"rda_Step3a.CensoredDataAndGridsList.Males.RData"));
#--remove zeros, infs, questionable observed Rs----
dfrDatp   = lst$dfrDat |> dplyr::filter(obsR<10, between(z,15,150));
#--fit various models for obsR using mgcv to fit GAMs for males using the TWEEDIE distribution----
require(DHARMa);
require(dplyr);
require(ggplot2);
require(gratia)
require(mgcv);
#--get censored data and prediction grids----
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path);
lst = wtsUtilities::getObj(file.path(dirThs,"rda_Step3a.CensoredDataAndGridsList.Males.RData"));
#--remove zeros, infs, questionable observed Rs----
dfrDatp   = lst$dfrDat |> dplyr::filter(obsR<10, between(z,15,150));
#dfrDatp   = lst$dfrDat |> dplyr::filter(between(z,15,150));
#--TWEEDIE (using mgcv::tw) regression  models for obsR----
famTW = mgcv::tw(link="identity");
#--------ALL Z 2-WAY INTERACTIONS--------------------------
#--ln(r) = ti(z) +
#--         ti(d) + ti(t) + ti(f) + ti(s) +
#--        ti(z,d) + ti(z,t) + ti(z,f) +ti(z,s)
ks=c(20,10);
k1 = ks[1]; k2 = ks[2];
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2)   + ti(f,bs="ts",k=k2)   + ti(s,bs="ts",k=k2) +
ti(z,d,bs="ts",k=c(k1,k2)) + ti(z,t,bs="ts",k=c(k1,k2)) + ti(z,f,bs="ts",k=c(k1,k2)) + ti(z,s,bs="ts",k=c(k1,k2));
# frmla  = obsR~ti(z,bs="ts",k=k1)   +
#            ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdl_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
#--run cross validation-------------------------------------------------
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdl_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="obsR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
wtsUtilities::saveObj(dfrCrsVal,file.path(dirThs,"rda_Step3b1.TweedieModels_CrsVal.RData"));
View(dfrCrsVal)
#--fit various models for obsR using mgcv to fit GAMs for females using the TWEEDIE distribution----
require(DHARMa);
require(dplyr);
require(ggplot2);
require(gratia)
require(mgcv);
#--get censored data and prediction grids----
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path);
lst = wtsUtilities::getObj(file.path(dirThs,"rda_Step3a.CensoredDataAndGridsList.Females.RData"));
#--remove zeros, infs, questionable observed Rs----
dfrDatp   = lst$dfrDat |> dplyr::filter(obsR<10, between(z,15,130));
#dfrDatp   = lst$dfrDat |> dplyr::filter(between(z,15,150));
#--TWEEDIE (using mgcv::tw) regression  models for obsR----
famTW = mgcv::tw(link="identity");
#--------ALL Z 2-WAY INTERACTIONS--------------------------
#--ln(r) = ti(z) +
#--         ti(d) + ti(t) + ti(f) + ti(s) +
#--        ti(z,d) + ti(z,t) + ti(z,f) +ti(z,s)
ks=c(20,10);
k1 = ks[1]; k2 = ks[2];
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2)   + ti(f,bs="ts",k=k2)   + ti(s,bs="ts",k=k2) +
ti(z,d,bs="ts",k=c(k1,k2)) + ti(z,t,bs="ts",k=c(k1,k2)) + ti(z,f,bs="ts",k=c(k1,k2)) + ti(z,s,bs="ts",k=c(k1,k2));
# frmla  = obsR~ti(z,bs="ts",k=k1)   +
#            ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdl_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
ks=c(10,8);
k1 = ks[1]; k2 = ks[2];
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2)   + ti(f,bs="ts",k=k2)   + ti(s,bs="ts",k=k2) +
ti(z,d,bs="ts",k=c(k1,k2)) + ti(z,t,bs="ts",k=c(k1,k2)) + ti(z,f,bs="ts",k=c(k1,k2)) + ti(z,s,bs="ts",k=c(k1,k2));
# frmla  = obsR~ti(z,bs="ts",k=k1)   +
#            ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdl_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/CrossVal_Females")
dirThs
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdl_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="obsR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
wtsUtilities::saveObj(dfrCrsVal,file.path(dirThs,"rda_Step3b1.TweedieModels_CrsVal.RData"));
View(dfrCrsVal)
require(DHARMa);
require(dplyr);
require(ggplot2);
require(gratia)
require(mgcv);
#--get censored data and prediction grids----
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path);
lst = wtsUtilities::getObj(file.path(dirThs,"rda_Step3a.CensoredDataAndGridsList.Females.RData"));
#--remove zeros, infs, questionable observed Rs----
dfrDatp   = lst$dfrDat |> dplyr::filter(obsR<10, is.finite(lnR),between(z,15,130));
#dfrDatp   = lst$dfrDat |> dplyr::filter(between(z,15,150));
#--TWEEDIE (using mgcv::tw) regression  models for lnR----
famTW = mgcv::tw(link="log");
#--------ALL Z 2-WAY INTERACTIONS--------------------------
#--ln(r) = ti(z) +
#--         ti(d) + ti(t) + ti(f) + ti(s) +
#--        ti(z,d) + ti(z,t) + ti(z,f) +ti(z,s)
ks=c(10,8);
k1 = ks[1]; k2 = ks[2];
frmla  = obsR~ti(z,bs="ts",k=k1)   +
ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2)   + ti(f,bs="ts",k=k2)   + ti(s,bs="ts",k=k2) +
ti(z,d,bs="ts",k=c(k1,k2)) + ti(z,t,bs="ts",k=c(k1,k2)) + ti(z,f,bs="ts",k=c(k1,k2)) + ti(z,s,bs="ts",k=c(k1,k2));
# frmla  = obsR~ti(z,bs="ts",k=k1)   +
#            ti(d,bs="ts",k=k2)   + ti(t,bs="ts",k=k2) ;
mdl_ZE2D  = mgcv::gam(frmla,family=famTW,data=dfrDatp,select=FALSE,method="ML",fit=FALSE);
source(file.path(dirThs,"../r_gam.prefit.functions.R"));
source(file.path(dirThs,"../r_EvalAllModelsFunctions.R"));
source(file.path(dirThs,"../r_RunCrossValidationFunctions.R"));
source(file.path(dirThs,"../r_LogLikeFunctions.R"));
setwd(dirThs);
set.seed(1111111);
mdl = mdl_ZE2D;
dfrCrsVal = runCrossValidation(
mdl,
ks,
dfrData=dfrDatp,
col_link="lnR",
numFolds=20,
selectBy="by_obs",
concrv_opt=2,
doParallel=TRUE,
ncores=parallel::detectCores()-1,
max_ncmbs=NULL,
icmbs=NULL,
log=TRUE,
debug=TRUE);
wtsUtilities::saveObj(dfrCrsVal,file.path(dirThs,"rda_Step3b1.LnTweedieModels_CrsVal.RData"));
