phi=phi_,
nB=rnbinom(N,mu=lambda_*aswB,size=1/phi_),
nN=rnbinom(N,mu=lambda_*aswN*q_,size=1/phi_),
rQ=(nN/aswN)/(nB/aswB));
lst2[[type_]] = dfrp; rm(dfrp);
}#--k
lst1[[as.character(q_)]] = dplyr::bind_rows(lst2);
rm(lst2);
}#--j
lst0[[as.character(lambda_)]] = dplyr::bind_rows(lst1);
rm(lst1);
}#--i
dfr = dplyr::bind_rows(lst0) |>
dplyr::mutate(type=factor(type,levels=c("poisson",paste0("extra ",phis))));
rm(lst0);
dfrStats = dfr |> dplyr::group_by(type,lambda,q,phi) |>
dplyr::summarize(mnB=mean(nB,na.rm=TRUE),
mnN=mean(nN,na.rm=TRUE),
nRs=sum(is.finite(rQ)),
mnQ=mean(rQ[is.finite(rQ)],na.rm=TRUE),
p05Q=quantile(rQ[is.finite(rQ)],probs=0.05,na.rm=TRUE),
p95Q=quantile(rQ[is.finite(rQ)],probs=0.95,na.rm=TRUE),
p10Q=quantile(rQ[is.finite(rQ)],probs=0.10,na.rm=TRUE),
p90Q=quantile(rQ[is.finite(rQ)],probs=0.90,na.rm=TRUE)) |>
dplyr::ungroup();
p = ggplot(dfrStats,
aes(x=q,y=nRs/N)) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(type~lambda,scales="fixed") +
labs(x="true q",y="% successful haul pairs") +
wtsPlots::getStdTheme();
print(p);
p0 = ggplot(dfrStats |> dplyr::filter(type=="poisson"),
aes(x=q,y=mnQ/q,ymin=p05Q/q,ymax=p95Q/q)) +
geom_ribbon(alpha=0.5,colour=NA,fill="blue") +
geom_ribbon(aes(ymin=p10Q/q,ymax=p90Q/q),alpha=0.25,colour=NA,fill="green") +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(lambda~.) +
wtsPlots::getStdTheme();
print(p0);
ggplot(dfrStats |> dplyr::filter(type=="poisson"),
aes(x=q,y=mnQ/q,ymin=p05Q/q,ymax=p95Q/q)) +
geom_ribbon(alpha=0.5,colour=NA,fill="blue") +
geom_ribbon(aes(ymin=p10Q/q,ymax=p90Q/q),alpha=0.25,colour=NA,fill="green") +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(lambda~type) +
wtsPlots::getStdTheme();
p1 = ggplot(dfrStats |> dplyr::filter(lambda==5000),
aes(x=q,y=mnQ/q,ymin=p05Q/q,ymax=p95Q/q)) +
geom_ribbon(alpha=0.5,colour=NA,fill="blue") +
geom_ribbon(aes(ymin=p10Q/q,ymax=p90Q/q),alpha=0.25,colour=NA,fill="green") +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(type~lambda,scales="free_y") +
labs(x="true q",y="ratio: (est q)/(true q)") +
wtsPlots::getStdTheme();
print(p1);
ggplot(dfrStats,
aes(x=q,y=mnQ/q,ymin=p05Q/q,ymax=p95Q/q)) +
geom_ribbon(alpha=0.5,colour=NA,fill="blue") +
geom_ribbon(aes(ymin=p10Q/q,ymax=p90Q/q),alpha=0.25,colour=NA,fill="green") +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(type~lambda,scales="free_y") +
labs(x="true q",y="ratio: (est q)/(true q)") +
wtsPlots::getStdTheme();
for (i in seq_along(lambdas)){
p1 = ggplot(dfrStats |> dplyr::filter(lambda==lambdas[i]),
aes(x=q,y=mnQ/q,ymin=p05Q/q,ymax=p95Q/q)) +
geom_ribbon(alpha=0.5,colour=NA,fill="blue") +
geom_ribbon(aes(ymin=p10Q/q,ymax=p90Q/q),alpha=0.25,colour=NA,fill="green") +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(type~lambda,scales="fixed") +
labs(x="true q",y="ratio: (est q)/(true q)") +
wtsPlots::getStdTheme();
print(p1);
}
ggplot(dfrS1,
aes(x=phi,y=mnPctBias)) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias") +
wtsPlots::getStdTheme();
dfrS1 = dfrStats |> dplyr::group_by(type,lambda,phi) |>
dplyr::summarize(mnPctBias=mean(mnQ/q)) |>
dplyr::ungroup();
p1 = ggplot(dfrS1,
aes(x=phi,y=mnPctBias)) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias") +
wtsPlots::getStdTheme();
print(p1);
ggplot(dfrS1,
aes(x=phi,y=mnPctBias,colour=factor(lambda,levels=as.character(lambdas)))) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
#facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias") +
wtsPlots::getStdTheme();
ggplot(dfrS1,
aes(x=phi,y=mnPctBias,colour=factor(lambda,levels=as.character(lambdas)))) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
#facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias",colour="density\n(number/sq. nmi.)") +
wtsPlots::getStdTheme();
ggplot(dfrS1,
aes(x=phi,y=mnPctBias,colour=factor(lambda,levels=as.character(lambdas)))) +
geom_line() +
geom_hline(yintercept=1,linetype=2) +
#facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias",colour="density\n(number/sq. nmi.)") +
wtsPlots::getStdTheme() +
theme(legend.position="inside",
legend.position.inside=c(0.01,0.99),
legend.justification=c(0,1));
dfrS1 = dfrStats |> dplyr::group_by(type,lambda,phi) |>
dplyr::summarize(mnPctBias=100*(mean(mnQ/q)-1) |>
dplyr::ungroup();
dfrS1 = dfrStats |> dplyr::group_by(type,lambda,phi) |>
dplyr::summarize(mnPctBias=100*(mean(mnQ/q)-1)) |>
dplyr::ungroup();
p1 = ggplot(dfrS1,
aes(x=phi,y=mnPctBias,colour=factor(lambda,levels=as.character(lambdas)))) +
geom_line() +
geom_hline(yintercept=0,linetype=2) +
#facet_grid(lambda~.,scales="free_y") +
labs(x="extra variability",y="mean % bias",colour="density\n(number/sq. nmi.)") +
wtsPlots::getStdTheme() +
theme(legend.position="inside",
legend.position.inside=c(0.01,0.99),
legend.justification=c(0,1));
print(p1);
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygessenIntercalibration")
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis")
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygesenIntercalibration")
devtools::install_github("Uffe-H-Thygesen/Intercalibration/gearcalib")
library(gearcalib)
load("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygesenIntercalibration/Intercalibration/Repaired-Trawl-Pairs/InterCal_Merluccius.RData")
library(TMB)
compile("gearcalib0.cpp",CXX="clang++")
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygesenIntercalibration/Intercalibration/Misc")
library(TMB)
compile("gearcalib0.cpp",CXX="clang++")
if(is.loaded("EvalDoubleFunObject")) dyn.unload("gearcalib0.so")
dyn.load("gearcalib0.so")
## Specify range of length classes to include in the model
Lmin <- 10
Lmax <- 80
Lvec <- seq(Lmin,Lmax)
fitmodel <- function(Species,GearNames,d)
{
## Construct table of which gears are used in which groups
tt <- table(d$group,d$Gear)
## Identify those groups where the two gears are used
UseGroups <- tt[,GearNames[1]] & tt[,GearNames[2]]
I <- sapply(d$group,function(g)UseGroups[g])
## Use only if SweptArea is finite
I <- I & is.finite(d$SweptArea)
## Select only these records
d$SweptArea <- d$SweptArea[I]
d$N <- d$N[I,Lmin:Lmax]
d$group <- factor(d$group[I],levels=unique(d$group[I]))
d$Gear <- factor(d$Gear[I],levels=GearNames)
nsize <- ncol(d$N)
ngroup <- nlevels(d$group)
nhaul <- nrow(d$N)
ngear <- nlevels(d$Gear)
obj <- MakeADFun(
data=list(
N=d$N,
SweptArea=d$SweptArea,
group=d$group,
Gear=d$Gear,
huge=10,
tiny=0.01
),
parameters=list(
logspectrum=matrix(0,ngroup,nsize),
## nugget=matrix(0,nhaul,nsize),
residual=matrix(0,nhaul,nsize),
loggear=numeric(nsize),
logsd=-1,
phi=.5,
## logsdnug=-1,
logsdres=-1,
logsdGearRW=-1,
alpha = 1
),
map = list(alpha=factor(NA)), # phi=factor(NA),logsdnug=factor(NA),logsdGearRW=factor(NA)),
random=c("logspectrum","residual","loggear"),
DLL="gearcalib0"
)
obj0 <- MakeADFun(
data=list(
N=d$N,
SweptArea=d$SweptArea,
group=d$group,
Gear=d$Gear,
huge=10,
tiny=0.01
),
parameters=list(
logspectrum=matrix(0,ngroup,nsize),
## nugget=matrix(0,nhaul,nsize),
residual=matrix(0,nhaul,nsize),
loggear=numeric(nsize),
logsd=-1,
phi=.5,
## logsdnug=-1,
logsdres=-1,
logsdGearRW=-10,
alpha = 1
),
## map = list(phi=factor(NA),logsdnug=factor(NA),logsdGearRW=factor(NA)),
map = list(alpha=factor(NA),logsdGearRW=factor(NA)),
random=c("logspectrum","residual","loggear"),
DLL="gearcalib0"
)
lower <- 0*obj$par-Inf
upper <- 0*obj$par+Inf
lower["phi"] <- 0
upper["phi"] <- 0.9999
system.time( opt <- nlminb(obj$par,obj$fn,obj$gr,lower=lower,upper=upper) )
system.time( opt0 <- nlminb(obj0$par,obj0$fn,obj0$gr,lower=lower,upper=upper) )
Pvalue <- pchisq(2*(opt0$objective-opt$objective),df=1)
print(paste("Chisq-test of no size structure in gear effect:",Pvalue))
rm(obj0)
save(list=ls(), file=paste("Image-",Species,"-",GearNames[2],"-vs-",GearNames[1],".Rdata",sep=""))
rep <- sdreport(obj)
repsum <- summary(rep)
s <- repsum[grep("gear",rownames(repsum)),]
est <- 2*s[,1]
sd <- 2*s[,2]
GearNames <- levels(d$Gear)
## Raw data: Total catches
I1 <- d$Gear==GearNames[1]
I2 <- d$Gear==GearNames[2]
totcatch1 <- apply(d$N[I1,],2,sum)
totcatch2 <- apply(d$N[I2,],2,sum)
Density1 <- totcatch1 / sum(d$SweptArea[I1])
Density2 <- totcatch2 / sum(d$SweptArea[I2])
## Plots
X11()
plot(c(Lmin,Lmax),c(0,max(exp(est + sd %o% c(0,-2,2)))),type="n",
ylim=c(0,2),
xlim=c(Lmin,Lmax),
xlab="Length [cm]",
ylab=paste(GearNames[2]," vs. ",GearNames[1]),
main=paste("Relative selectivity for", Species))
lines(c(Lmin,Lmax),rep(1,2),col="darkgrey",lwd=3,lty="dashed")
polygon(c(Lmin:Lmax,Lmax:Lmin),c(exp(est-2*sd),rev(exp(est+2*sd))),
col="grey",border=NA)
lines(Lmin:Lmax,exp(est),lwd=3)
points(Lmin:Lmax,Density2/Density1)
grid()
dev.copy2pdf(file=paste("Relsel-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
plot(Lmin:Lmax,log10(1+Density1),
ylim=log10(1+range(c(Density1,Density2))),
xlim=c(Lmin,Lmax),
type="l",lty="dashed",
xlab="Length [cm]",ylab="Density (log10(N/A+1))")
points(Lmin:Lmax,log10(1+Density1),pch="o")
lines(Lmin:Lmax,log10(1+Density2))
points(Lmin:Lmax,log10(1+Density2),pch="+")
legend("topright",legend=GearNames,lty=c("dashed","solid"),pch=c("o","+"))
grid()
dev.copy2pdf(file=paste("Density-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
## #############################################################################################
## Plot example of a size spectrum
pl <- obj$env$parList()
spec <- pl$logspectrum
## Take the station witht the largest catch
ii <- which.max(apply(spec,1,sum))
iii <- which(d$group == levels(d$group)[ii])
res1 <- pl$residual[iii,]
plot(Lmin:Lmax,exp(spec[ii,])*d$SweptArea[ii],log="y",type="l",ylim=c(1e-1,max(d$N[iii,])),
xlim=c(Lmin,Lmax),
xlab="Length [cm]",ylab="Size spectrum of population [#/cm]",lwd=3,
main=paste(Species,"at station",d$group[ii]))
grid()
lines(Lmin:Lmax,exp(spec[ii,] + res1[1,])*d$SweptArea[ii],lty="solid")
lines(Lmin:Lmax,exp(spec[ii,] + res1[2,])*d$SweptArea[ii],lty="dashed")
points(Lmin:Lmax,d$N[iii[1],],pch="+")
points(Lmin:Lmax,d$N[iii[2],],pch="o")
legend("bottom",legend=c("Size structure at station",
paste(GearNames[1],", observed and modelled"),
paste(GearNames[2],", observed and modelled")),
lwd=c(3,1,1),lty=c("solid","solid","dashed"),pch=c(NA,"+","o"))
grid()
dev.copy2pdf(file=paste("Sample-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
res <- data.frame(L=Lmin:Lmax,est=est,sd=sd)
write.table(res,file=paste("Results-",Species,"-",GearNames[2],"-vs-",GearNames[1],".csv",sep=""))
write.table(res,file=paste("Estimates-",Species,"-",GearNames[2],"-vs-",GearNames[1],".csv",sep=""))
return(list(Species=Species,GearNames=GearNames,d=d,res=res,Pvalue=Pvalue,rep=rep,opt=opt,obj=obj))
}
fits <- list()
Dir <- "Repaired-Trawl-Pairs"
filename <- paste(Dir,"InterCal_Merluccius.RData",sep="/")
load(filename)
getwd()
file.path("../..",getwd());
normalizePath(file.path("../..",getwd()));
normalizePath(file.path(getwd(),"../.."));
Dir <- "Repaired-Trawl-Pairs"
filename <- file.path(dirPrj,"Intercalibration",Dir,"InterCal_Merluccius.RData")
##--set working directory to folder with this file before running the next line
dirPrj = normalizePath(file.path(getwd(),"../.."));
dirPrj
Dir <- "Verification"
filename <- paste(Dir,"InterCal_Merluccius_1998_1999.RData",sep="/")
load(filename)
Dir <- "Repaired-Trawl-Pairs"
filename <- file.path(dirPrj,"Intercalibration",Dir,"InterCal_Merluccius.RData")
load(filename)
View(listIntercalData_Capensis)
View(listIntercalData_Capensis$N)
#--testing: Species = "Capensis"; gear = "Afr_New";
d <- eval(parse(text=paste("listIntercalData_",Species,sep="")))
Species = "Capensis"; gear = "Afr_New";
#--testing: Species = "Capensis"; gear = "Afr_New";
d <- eval(parse(text=paste("listIntercalData_",Species,sep="")))
View(d$SweptArea)
d$group <- factor(d$group)
## Change order of gear such that Gisund is reference
d$Gear <- factor(d$Gear,levels=rev(unique(d$Gear)))
d$SweptArea <- d$SweptArea[,1]
## Compare these two gear types
GearNames <- c("Gisund",gear)
View(d$Gear)
fits[[length(fits)+1]] <- fitmodel(Species,GearNames,d)
fits[[length(fits)+1]] <- fitmodel(Species,GearNames,d)
fits[[length(fits)+1]] <- fitmodel(Species,GearNames,d)
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygesenIntercalibration/Intercalibration")
setwd("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04a_ThygesenIntercalibration/Intercalibration/Misc")
library(TMB)
##--set working directory to folder with this file before running the next line
dirPrj = normalizePath(file.path(getwd(),"../.."));
#--compile cpp file
setwd(file.path(dirPrj,"Intercalibration/Misc"));
compile("gearcalib0.cpp",CXX="clang++")
dyn.load("gearcalib0.so")
setwd(dirPrj);
## Specify range of length classes to include in the model
Lmin <- 10
Lmax <- 80
Lvec <- seq(Lmin,Lmax)
fitmodel <- function(Species,GearNames,d)
{
## Construct table of which gears are used in which groups
tt <- table(d$group,d$Gear)
## Identify those groups where the two gears are used
UseGroups <- tt[,GearNames[1]] & tt[,GearNames[2]]
I <- sapply(d$group,function(g)UseGroups[g])
## Use only if SweptArea is finite
I <- I & is.finite(d$SweptArea)
## Select only these records
d$SweptArea <- d$SweptArea[I]
d$N <- d$N[I,Lmin:Lmax]
d$group <- factor(d$group[I],levels=unique(d$group[I]))
d$Gear <- factor(d$Gear[I],levels=GearNames)
nsize <- ncol(d$N)
ngroup <- nlevels(d$group)
nhaul <- nrow(d$N)
ngear <- nlevels(d$Gear)
obj <- MakeADFun(
data=list(
N=d$N,
SweptArea=d$SweptArea,
group=d$group,
Gear=d$Gear,
huge=10,
tiny=0.01
),
parameters=list(
logspectrum=matrix(0,ngroup,nsize),
## nugget=matrix(0,nhaul,nsize),
residual=matrix(0,nhaul,nsize),
loggear=numeric(nsize),
logsd=-1,
phi=.5,
## logsdnug=-1,
logsdres=-1,
logsdGearRW=-1,
alpha = 1
),
map = list(alpha=factor(NA)), # phi=factor(NA),logsdnug=factor(NA),logsdGearRW=factor(NA)),
random=c("logspectrum","residual","loggear"),
DLL="gearcalib0"
)
obj0 <- MakeADFun(
data=list(
N=d$N,
SweptArea=d$SweptArea,
group=d$group,
Gear=d$Gear,
huge=10,
tiny=0.01
),
parameters=list(
logspectrum=matrix(0,ngroup,nsize),
## nugget=matrix(0,nhaul,nsize),
residual=matrix(0,nhaul,nsize),
loggear=numeric(nsize),
logsd=-1,
phi=.5,
## logsdnug=-1,
logsdres=-1,
logsdGearRW=-10,
alpha = 1
),
## map = list(phi=factor(NA),logsdnug=factor(NA),logsdGearRW=factor(NA)),
map = list(alpha=factor(NA),logsdGearRW=factor(NA)),
random=c("logspectrum","residual","loggear"),
DLL="gearcalib0"
)
lower <- 0*obj$par-Inf
upper <- 0*obj$par+Inf
lower["phi"] <- 0
upper["phi"] <- 0.9999
system.time( opt <- nlminb(obj$par,obj$fn,obj$gr,lower=lower,upper=upper) )
system.time( opt0 <- nlminb(obj0$par,obj0$fn,obj0$gr,lower=lower,upper=upper) )
Pvalue <- pchisq(2*(opt0$objective-opt$objective),df=1)
print(paste("Chisq-test of no size structure in gear effect:",Pvalue))
rm(obj0)
save(list=ls(), file=paste("Image-",Species,"-",GearNames[2],"-vs-",GearNames[1],".Rdata",sep=""))
rep <- sdreport(obj)
repsum <- summary(rep)
s <- repsum[grep("gear",rownames(repsum)),]
est <- 2*s[,1]
sd <- 2*s[,2]
GearNames <- levels(d$Gear)
## Raw data: Total catches
I1 <- d$Gear==GearNames[1]
I2 <- d$Gear==GearNames[2]
totcatch1 <- apply(d$N[I1,],2,sum)
totcatch2 <- apply(d$N[I2,],2,sum)
Density1 <- totcatch1 / sum(d$SweptArea[I1])
Density2 <- totcatch2 / sum(d$SweptArea[I2])
## Plots
X11()
plot(c(Lmin,Lmax),c(0,max(exp(est + sd %o% c(0,-2,2)))),type="n",
ylim=c(0,2),
xlim=c(Lmin,Lmax),
xlab="Length [cm]",
ylab=paste(GearNames[2]," vs. ",GearNames[1]),
main=paste("Relative selectivity for", Species))
lines(c(Lmin,Lmax),rep(1,2),col="darkgrey",lwd=3,lty="dashed")
polygon(c(Lmin:Lmax,Lmax:Lmin),c(exp(est-2*sd),rev(exp(est+2*sd))),
col="grey",border=NA)
lines(Lmin:Lmax,exp(est),lwd=3)
points(Lmin:Lmax,Density2/Density1)
grid()
dev.copy2pdf(file=paste("Relsel-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
plot(Lmin:Lmax,log10(1+Density1),
ylim=log10(1+range(c(Density1,Density2))),
xlim=c(Lmin,Lmax),
type="l",lty="dashed",
xlab="Length [cm]",ylab="Density (log10(N/A+1))")
points(Lmin:Lmax,log10(1+Density1),pch="o")
lines(Lmin:Lmax,log10(1+Density2))
points(Lmin:Lmax,log10(1+Density2),pch="+")
legend("topright",legend=GearNames,lty=c("dashed","solid"),pch=c("o","+"))
grid()
dev.copy2pdf(file=paste("Density-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
## #############################################################################################
## Plot example of a size spectrum
pl <- obj$env$parList()
spec <- pl$logspectrum
## Take the station witht the largest catch
ii <- which.max(apply(spec,1,sum))
iii <- which(d$group == levels(d$group)[ii])
res1 <- pl$residual[iii,]
plot(Lmin:Lmax,exp(spec[ii,])*d$SweptArea[ii],log="y",type="l",ylim=c(1e-1,max(d$N[iii,])),
xlim=c(Lmin,Lmax),
xlab="Length [cm]",ylab="Size spectrum of population [#/cm]",lwd=3,
main=paste(Species,"at station",d$group[ii]))
grid()
lines(Lmin:Lmax,exp(spec[ii,] + res1[1,])*d$SweptArea[ii],lty="solid")
lines(Lmin:Lmax,exp(spec[ii,] + res1[2,])*d$SweptArea[ii],lty="dashed")
points(Lmin:Lmax,d$N[iii[1],],pch="+")
points(Lmin:Lmax,d$N[iii[2],],pch="o")
legend("bottom",legend=c("Size structure at station",
paste(GearNames[1],", observed and modelled"),
paste(GearNames[2],", observed and modelled")),
lwd=c(3,1,1),lty=c("solid","solid","dashed"),pch=c(NA,"+","o"))
grid()
dev.copy2pdf(file=paste("Sample-",Species,"-",GearNames[2],"-vs-",GearNames[1],".pdf",sep=""))
res <- data.frame(L=Lmin:Lmax,est=est,sd=sd)
write.table(res,file=paste("Results-",Species,"-",GearNames[2],"-vs-",GearNames[1],".csv",sep=""))
write.table(res,file=paste("Estimates-",Species,"-",GearNames[2],"-vs-",GearNames[1],".csv",sep=""))
return(list(Species=Species,GearNames=GearNames,d=d,res=res,Pvalue=Pvalue,rep=rep,opt=opt,obj=obj))
}
fits <- list()
Dir <- "Repaired-Trawl-Pairs"
filename <- file.path(dirPrj,"Intercalibration",Dir,"InterCal_Merluccius.RData")
load(filename)
Species = "Capensis"; gear = "Afr_New";
d <- eval(parse(text=paste("listIntercalData_",Species,sep="")))
d$group <- factor(d$group)
## Change order of gear such that Gisund is reference
d$Gear <- factor(d$Gear,levels=rev(unique(d$Gear)))
d$SweptArea <- d$SweptArea[,1]
GearNames <- c("Gisund",gear)
fits[[length(fits)+1]] <- fitmodel(Species,GearNames,d)
