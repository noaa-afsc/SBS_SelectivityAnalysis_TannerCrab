ci=0.95);
View(mdfr)
rCompTCMs::compareFits.BiomassData(objs=models,
fleets=c("NMFS M",
"NMFS F"),
fleet.type="survey",
catch.type="index",
plot1stObs=FALSE);
unique(mdfr$case)
case<-c("25_01");
resDir = "./run_results";
models = list();
models[[case]] = wtsUtilities::getObj(file.path(resDir,"Results.RData"));
rCompTCMs::compareFits.BiomassData(objs=models,
fleets=c("SBS BSFRF M",
"SBS BSFRF F"),
fleet.type="survey",
catch.type="index");
rCompTCMs::compareFits.BiomassData(objs=models,
fleets=c("NMFS M",
"NMFS F"),
fleet.type="survey",
catch.type="index");
setwd("~/Work/StockAssessments-Crab/Assessments/TannerCrab/2025-05_TannerCrab/TannerCrab_202505/ModelRuns/ModelRuns-TCSAM02/2025_25_01a")
#convert TCSAM02 model output to RData files
require(rTCSAM02)
dirThis = dirname((rstudioapi::getActiveDocumentContext())$path);
setwd(dirThis);
case<-c("25_01a");
runDir = "run";
resDir = "./run_results";
if (!dir.exists(resDir)) dir.create(resDir);
#--remove old results files
fns1<-list.files(path=resDir,pattern=glob2rx("OFCs*.csv"));
fns2<-list.files(path=resDir,pattern=glob2rx("Results*.RData"));
if (length(fns1)>0) file.remove(file.path(resDir,fns1))
if (length(fns2)>0) file.remove(file.path(resDir,fns2));
#--create new results files
best<-rTCSAM02::getResLst(file.path(runDir),verbose=TRUE)
if (!is.null(best)) {
wtsUtilities::saveObj(best,fn=file.path(resDir,"Results.RData"));
mdfr<-rTCSAM02::getMDFR.OFCs.DataComponents(best,verbose=FALSE);
readr::write_csv(mdfr,file=file.path(resDir,"OFCs.DataComponents.csv"));
mdfrp<-rTCSAM02::getMDFR.OFCs.NonDataComponents(best,verbose=FALSE)
readr::write_csv(mdfrp,file=file.path(resDir,"OFCs.NonDataComponents.csv"));
rm(best,mdfr,mdfrp)
}
models<-list();
models[[case]] = wtsUtilities::getObj(fn=file.path(resDir,"Results.RData"));
compare = names(models);
#--extract tables and create plots
dfr.PVs   <-rCompTCMs::extractMDFR.Results.ParameterValues(models[compare]);
readr::write_csv(dfr.PVs,file.path(resDir,"ParamValues.csv"))
dfr.PsAtBs<-rCompTCMs::extractMDFR.Results.ParametersAtBounds(models[compare],delta=0.001);
if (!is.null(dfr.PsAtBs)&&inherits(dfr.PsAtBs,"data.frame")){
readr::write_csv(dfr.PsAtBs,file.path(resDir,"ParamsAtBounds.csv"));
cat(paste0(dfr.PsAtBs$name," ",dfr.PsAtBs$test," [",dfr.PsAtBs$label,"]\n"));
} else {
message("No parameters at bounds!!");
}
dfr.OFLs<-rTCSAM02::getMDFR.OFLResults(models[compare],verbose=TRUE);
if (!is.null(dfr.OFLs)){
dfr.OFLs$avgRec<-dfr.OFLs$avgRecM + dfr.OFLs$avgRecF;
dfr.OFLs<-wtsUtilities::deleteCols(dfr.OFLs,cols=c("avgRecM","avgRecF"),debug=FALSE);
dfr.OFLs<-dfr.OFLs[,c("case","objFun","maxGrad","avgRec","B100","Bmsy","curB","Fmsy","MSY","Fofl","OFL","prjB")];
readr::write_csv(dfr.OFLs,file.path(resDir,"oflResults.csv"))
}
if (file.exists(file.path(runDir,"admodel.hes"))){
adnuts::check_identifiable("tcsam02",path=runDir)
lst = adnuts:::.read_mle_fit("tcsam02",path=runDir)
hes = adnuts:::.getADMBHessian(path=runDir)
evs_hes = eigen(hes)$values
min_hes = head(sort(evs_hes)); print(min_hes);
}
#--plot results
case<-c("25_01a");
resDir = "./run_results";
models = list();
models[[case]] = wtsUtilities::getObj(file.path(resDir,"Results.RData"));
#--selectivity----
rCompTCMs::compareResults.Surveys.CaptureProbs(models,
fleets=c("NMFS M",
"NMFS F",
"SBS BSFRF M",
"SBS BSFRF F"));
#-surveys (biomass)--------------------------------------------
mdfr<-rCompTCMs::extractMDFR.Fits.BiomassData(objs=models,
fleets="all",
fleet.type="survey",
catch.type="index",
ci=0.95);
rCompTCMs::compareFits.BiomassData(objs=models,
fleets=c("NMFS M",
"NMFS F"),
fleet.type="survey",
catch.type="index");
load("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/05_Simulations/EstimatedOneHaulSamplingVariability.RData")
dfrStats=obj$dfrStats
obj$plt
obj$lst$`5`$plt
obj$lst$`100`$plt
View(dfrStats)
lambda = 10; A = 1; mu = lambda *A;
q = (0:100)/100;
dp = ppois(q=q,lambda=mu)
#db = dpnbinom(q=
dfr = tibble::tibbble(q,dp)
#db = dpnbinom(q=
dfr = tibble::tibble(q,dp)
#--extra poisson variance
require(ggplot2)
lambda = 10; A = 1; mu = lambda *A;
x = (0:100);
dp = dpois(x=x,lambda=mu)
dp = dpois(x=x,lambda=mu)
#db = dpnbinom(q=
dfr = tibble::tibble(q,dp)
ggplot(dfr,aes(x=dp,y=q)) + geom_point()
x = (0:100);
dp = dpois(x=x,lambda=mu)
#db = dpnbinom(q=
dfr = tibble::tibble(x,dp)
ggplot(dfr,aes(x=x,y=dp)) + geom_point()
ggplot(dfr,aes(x=x,y=dp)) + geom_point() + geom_vline(xintercept=lambda*A,lintype=3)
ggplot(dfr,aes(x=x,y=dp)) + geom_point() + geom_vline(xintercept=lambda*A,linetype=3)
ggplot(dfr,aes(x=x,y=dp)) + geom_point() +
geom_vline(xintercept=lambda*A,linetype=3) +
geom_vline(xintercept=lambda*A+sqrt(mu)*c(-1,1),linetype=3)
db = dpnbinom(x=x,mu=mu,size=1/phi);
db = dnbinom(x=x,mu=mu,size=1/phi);
phi = 1;
dfrb = tibble::tibble(x,val=db,type="extra",size=1/phi)
db = dnbinom(x=x,mu=mu,size=1/phi);
dfrb = tibble::tibble(x,val=db,type="extra",phi=phi)
lambda = 10; A = 1; mu = lambda *A;
x = (0:100);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
phi = 1;
dp = dpois(x=x,lambda=mu)
db = dnbinom(x=x,mu=mu,size=1/phi);
dfrb = tibble::tibble(x,val=db,type="extra",phi=phi)
dfr = dplyr::bind_rows(dfrp,dfrb)
ggplot(dfr,aes(x=x,y=dp,colour=type)) +
geom_point() +
geom_vline(xintercept=lambda*A,linetype=3) +
geom_vline(xintercept=lambda*A+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=lambda*A,linetype=3) +
geom_vline(xintercept=lambda*A+sqrt(mu)*c(-1,1),linetype=3)
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() +
geom_vline(xintercept=lambda*A,linetype=3) +
geom_vline(xintercept=lambda*A+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=lambda*A,linetype=3) +
geom_vline(xintercept=lambda*A+sqrt(mu)*c(-1,1),linetype=3)
lambda = 10; A = 1; mu = lambda *A;
x = (0:100);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
phi = 1;
dp = dpois(x=x,lambda=mu)
db = dnbinom(x=x,mu=mu,size=1/phi);
dfrb = tibble::tibble(x,val=db,type="extra",phi=phi)
dfr = dplyr::bind_rows(dfrp,dfrb)
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() +
geom_vline(xintercept=mu,linetype=3) +
geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
wtsPlots::getStdTheme()
phi = 0.1;
dp = dpois(x=x,lambda=mu)
db = dnbinom(x=x,mu=mu,size=1/phi);
dfrb = tibble::tibble(x,val=db,type="extra",phi=phi)
dfr = dplyr::bind_rows(dfrp,dfrb)
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() +
geom_vline(xintercept=mu,linetype=3) +
geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
wtsPlots::getStdTheme()
x = (0:100);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
dp = dpois(x=x,lambda=mu);
phis = c(0.1,0.25,0.50,0.75,1.0,1.25,1.5);
lst = list();
for (phi in phis){
db = dnbinom(x=x,mu=mu,size=1/phi);
lst[[as.character(phi)]] = tibble::tibble(x,val=db,type=paste0("xtra ",phi),phi=phi);
}
dfrb = dplyr::bind_rows(lst);
dfr = dplyr::bind_rows(dfrp,dfrb);
dfr$type = factor(dfr$type,levels=c("poisson",paste0("extra ",phis)));
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
wtsPlots::getStdTheme()
lambda = 10; A = 1; mu = lambda *A;
x = (0:100);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
dp = dpois(x=x,lambda=mu);
phis = c(0.1,0.25,0.50,0.75,1.0,1.25,1.5);
lst = list();
for (phi in phis){
db = dnbinom(x=x,mu=mu,size=1/phi);
lst[[as.character(phi)]] = tibble::tibble(x,val=db,type=paste0("extra ",phi),phi=phi);
}
dfrb = dplyr::bind_rows(lst);
dfr = dplyr::bind_rows(dfrp,dfrb);
dfr$type = factor(dfr$type,levels=c("poisson",paste0("extra ",phis)));
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
wtsPlots::getStdTheme()
lambda = 50; A = 1; mu = lambda *A;
x = (0:100);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
dp = dpois(x=x,lambda=mu);
phis = c(0.1,0.25,0.50,0.75,1.0,1.25,1.5);
lst = list();
for (phi in phis){
db = dnbinom(x=x,mu=mu,size=1/phi);
lst[[as.character(phi)]] = tibble::tibble(x,val=db,type=paste0("extra ",phi),phi=phi);
}
dfrb = dplyr::bind_rows(lst);
dfr = dplyr::bind_rows(dfrp,dfrb);
dfr$type = factor(dfr$type,levels=c("poisson",paste0("extra ",phis)));
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
wtsPlots::getStdTheme()
lambda = 50; A = 1; mu = lambda *A;
x = (0:100);
dp = dpois(x=x,lambda=mu);
dfrp = tibble::tibble(x,val=dp,type="poisson",phi=0);
phis = c(0.1,0.25,0.50,0.75,1.0,1.25,1.5);
lst = list();
for (phi in phis){
db = dnbinom(x=x,mu=mu,size=1/phi);
lst[[as.character(phi)]] = tibble::tibble(x,val=db,type=paste0("extra ",phi),phi=phi);
}
dfrb = dplyr::bind_rows(lst);
dfr = dplyr::bind_rows(dfrp,dfrb);
dfr$type = factor(dfr$type,levels=c("poisson",paste0("extra ",phis)));
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu)*c(-1,1),linetype=3) +
geom_vline(xintercept=mu,linetype=3) +
#geom_vline(xintercept=mu+sqrt(mu*(1+mu*phi))*c(-1,1),linetype=3,colour="orange") +
labs(x="number caught",y="probability") +
wtsPlots::getStdTheme()
load("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/01_SBS_Data/rda_Step4_SBS_VarVsMeanCPUE_Analysis.RData")
View(obj)
obj$mdlSmryTWP$reduced
obj$mdlsTWP$reduced
obj$`fig-VMRsCPUEMales`
obj$`fig-VarVsMeanCPUEByFleet`
pwr = 1.5456; #--'lnmn' from reduced model
phi = 4.6743; #--intercept from reduced model
mnAswB = 0.002;#--sq nmi BSFRF
mnAswN = 0.012;#--sq nmi NMFS
cpues = c(100,500,1000);#--number/sq nmi
cpue = cpues[1];
x = seq(5,2000,5)
dt = tweedie::dtweedie(x,mu=cpue*mnAswB,phi=exp(phi),power=pwr)
dfr = tibble::tibble(x,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
mu=cpue*mnAswB;
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
mu
cpue = cpues[3];
mu=cpue*mnAswB;
x = seq(5,2000,5)
dt = tweedie::dtweedie(x,mu=cpue*mnAswB,phi=exp(phi),power=pwr)
dfr = tibble::tibble(x,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
cpue = cpues[3];
mu=cpue*mnAswB;
x = seq(5,2000,5)
dt = tweedie::dtweedie(x,mu=cpue*mnAswB,phi=exp(phi),power=pwr)
dfr = tibble::tibble(x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
cpue = cpues[3];
mu=cpue*mnAswB;
x = seq(5,2000,5)
dt = tweedie::dtweedie(x,mu=cpue*mnAswB,phi=exp(phi),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
mn
mu
cpue = 10000;
mu=cpue*mnAswB;
x = seq(5,2000,5)
dt = tweedie::dtweedie(x*mnAswB,mu=cpue*mnAswB,phi=exp(phi),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
exp(4.6)
phi+(2-pwr)*log(mnAswB)
pwr = 1.5456; #--'lnmn' from reduced model
phi = 4.6743; #--intercept from reduced model
mnAswB = 0.002;#--sq nmi BSFRF
mnAswN = 0.012;#--sq nmi NMFS
cpues = c(100,500,1000);#--number/sq nmi
cpue = 10000;
mu=cpue;
x = seq(5,2000,5)
dt = tweedie::dtweedie(x*mnAswB,mu=cpue*mnAswB,phi=exp(phi+(2-pwr)*log(mnAswB)),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_point() + geom_line() +
geom_vline(xintercept=mu,linetype=3)
cpue = 10000;
mu=cpue*mnAswB;
x = seq(5,20000,5)
dt = tweedie::dtweedie(x*mnAswB,mu=cpue*mnAswB,phi=exp(phi+(2-pwr)*log(mnAswB)),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_line() +
geom_vline(xintercept=mu,linetype=3)
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_line() +
geom_vline(xintercept=mu,linetype=3) +
scale_y_continuous(limits=c(0,NA)) +
labs(x="catch numbers",y="probability") +
wtsPlots::getStdTheme()
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_line() +
geom_vline(xintercept=mu,linetype=3) +
geom_hline(yintercept=0,linetype=3) +
scale_y_continuous(limits=c(0,NA)) +
labs(x="catch numbers",y="probability") +
wtsPlots::getStdTheme()
cpue = 10000;
mu=cpue*mnAswB;
x = c(seq(5,1000,5),seq(2000,100000,1000));
dt = tweedie::dtweedie(x*mnAswB,mu=cpue*mnAswB,phi=exp(phi+(2-pwr)*log(mnAswB)),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_line() +
geom_vline(xintercept=mu,linetype=3) +
geom_hline(yintercept=0,linetype=3) +
scale_y_continuous(limits=c(0,NA)) +
labs(x="catch numbers",y="probability") +
wtsPlots::getStdTheme();
cpue = 1000;
mu=cpue*mnAswB;
x = c(seq(5,1000,5),seq(2000,100000,1000));
dt = tweedie::dtweedie(x*mnAswB,mu=cpue*mnAswB,phi=exp(phi+(2-pwr)*log(mnAswB)),power=pwr)
dfr = tibble::tibble(x=x*mnAswB,val=dt,type="tweedie")
ggplot(dfr,aes(x=x,y=val,colour=type)) +
geom_line() +
geom_vline(xintercept=mu,linetype=3) +
geom_hline(yintercept=0,linetype=3) +
scale_y_continuous(limits=c(0,NA)) +
labs(x="catch numbers",y="probability") +
wtsPlots::getStdTheme();
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path)
#--get observed CPUEs by haul
#----want to use tcsamSurveyData functions for this: they scale by area swept
require(ggplot2);
require(rlang);
require(tables);
require(wtsSizeComps);
source("r_Functions-Figures-Abundance.R")
source(file.path(dirThs,"../01_SBS_Data/r_Functions-Figures-Abundance.R"))
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path)
source(file.path(dirThs,"../01_SBS_Data/r_Functions-Figures-Abundance.R"))
source(file.path(dirThs,"../01_SBS_Data/r_Functions-Calcs-Abundance.R"))
#--create list for output----
out = list();
#--get haul-level data----
lst = wtsUtilities::getObj(file.path(dirThs,"../01_SBS_Data/rda_Step1_SBS_RawData.RData"));
View(lst)
#--define size bins----
cutpts = seq(-0.5,204.5,5);
zBs    = wtsUtilities::calcMidpoints(cutpts);
out = c(out,list(cutpts=cutpts,zBs=zBs));
#--calculate numbers caught by haul----
##--combine individual data from gear types
dfrID_SBS = dplyr::bind_rows(
lst$dfrID_BSFRF_SBS |>
dplyr::inner_join(lst$dfrHD_BSFRF_SBS,by="HAULJOIN") |>
dplyr::select(YEAR,station=GIS_STATION,SEX,MATURITY,SHELL_CONDITION,SIZE,
numIndivs,SAMPLING_FACTOR) |>
dplyr::mutate(gear="BSFRF"),
lst$dfrID_NMFS_SBS |>
dplyr::inner_join(lst$dfrHD_NMFS_SBS,by="HAULJOIN") |>
dplyr::select(YEAR,station=GIS_STATION,SEX,MATURITY,SHELL_CONDITION,SIZE,
numIndivs,SAMPLING_FACTOR) |>
dplyr::mutate(gear="NMFS")) |>
dplyr::rename_with(tolower,.cols=!numIndivs) |>
dplyr::filter(sex %in% c("MALE","FEMALE"));#--drop other categories
#--determine unique year/station combinations and all size bins
dfrYSZ = dfrID_SBS |> dplyr::distinct(year,station) |>
dplyr::cross_join(tibble::tibble(size=zBs));
View(dfrID_SBS)
View(lst$dfrID_BSFRF_SBS)
dfrCPUE_BSFRF = tcsamSurveyData::calcCPUE.ByHaul(lst$dfrHD_BSFRF_SBS,
lst$dfrID_BSFRF_SBS,
bySex=TRUE,
byMaturity=FALSE,
byShellCondition=FALSE,
bySize=TRUE,
cutpts=cutpts);
View(dfrCPUE_BSFRF)
dfrCPUE_NMFS  = tcsamSurveyData::calcCPUE.ByHaul(lst$dfrHD_NMFS_SBS,
lst$dfrID_NMFS_SBS,
bySex=TRUE,
byMaturity=FALSE,
byShellCondition=FALSE,
bySize=TRUE,
cutpts=cutpts);
dfrCPUE = dplyr::bind_rows(dfrCPUE_BSFRF |> dplyr::mutate(gear="BSFRF"),
dfrCPUE_NMFS  |> dplyr::mutate(gear="NMFS"))
dfrCPUE = dplyr::bind_rows(dfrCPUE_BSFRF |> dplyr::mutate(gear="BSFRF"),
dfrCPUE_NMFS  |> dplyr::mutate(gear="NMFS",HAULJOIN=as.character(HAULJOIN))) |>
dplyr::rename_with(tolower,.cols=!numIndivs) |>
dplyr::filter(sex %in% c("MALE","FEMALE"));#--drop other categories
View(dfrCPUE)
names(dfrCPUE)
load("~/Work/Projects/SBS_SelectivityAnalysis_TannerCrab/Analysis/04_HaulLevelCatchability/rda_Step1b_dfrPropsAllSBSYears.RData")
View(obj)
1/.00261
#--get observed CPUEs by haul
#----want to use tcsamSurveyData functions for this: they scale by area swept
require(ggplot2);
require(rlang);
require(tables);
require(wtsSizeComps);
dirThs = dirname(rstudioapi::getActiveDocumentContext()$path)
dfr = wtsUtilities::getObj(file.path(dirThs,"../04_HaulLevelCatchability/rda_Step1b_dfrPropsAllSBSYears.RData"));
View(dfr)
names(dfr)
dfrCPUE = dfr |> dplyr::select(YEAR,HAULJOIN,SEX,SIZE,numNMFS,aswNMFS,expfNMFS,numBSFRF,aswBSFRF,expfBSFRF) |>
dplyr::mutate(cpueNMFS=numNMFS*expfNMFS,cpueBSFRF=numBSFRF*expfBSFRF);
dfrCPUE = dfr |> dplyr::select(YEAR,HAULJOIN,SEX,SIZE,numNMFS,aswNMFS,expfNMFS,numBSFRF,aswBSFRF,expfBSFRF) |>
dplyr::mutate(cpueNMFS=numNMFS*expfNMFS,cpueBSFRF=numBSFRF*expfBSFRF) |>
dplyr::rename_with(tolower,.cols=c(HAULJOIN,YEAR,SEX,SIZE));
ggplot(dfrCPUE,aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF),colour="blue",alpha=0.3)
ggplot(dfrCPUE,aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
wtsPlots::getStdTheme()
ggplot(dfrCPUE,aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
ggplot(dfrCPUE |> dplyr::filter(numBSFRF>4),aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
ggplot(dfrMnCPUE,aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="mean CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
dfrMnCPUE = dfrCPUE |> dplyr::group_by(year,sex,size) |>
dplyr::summarize(cpueNMFS=mean(cpueNMFS),
varNMFS=var(cpueNMFS),
cpueBSFRF=mean(cpueBSFRF),
varBSFRF=var(cpueBSFRF))
ggplot(dfrMnCPUE,aes(x=size)) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="mean CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
ggplot(dfrMnCPUE,aes(x=size)) +
geom_smooth(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_smooth(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="mean CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
ggplot(dfrCPUE |> dplyr::filter(numBSFRF>4),aes(x=size)) +
geom_smooth(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_point(aes(y=cpueNMFS),colour="green",alpha=0.3) +
geom_smooth(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
geom_point(aes(y=cpueBSFRF,x=size+2),colour="blue",alpha=0.3) +
scale_y_log10() +
labs(x="size (mm CW)",y="CPUE (num/sq. nmi.)") +
wtsPlots::getStdTheme()
