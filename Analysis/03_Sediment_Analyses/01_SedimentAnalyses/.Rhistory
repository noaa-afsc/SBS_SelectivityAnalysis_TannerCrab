install.packages("tidyverse")
install.packages("sf")
install.packages("sf")
install.packages("TMB")
install.packages("tmap")
install.packages("tmaptools")
install.packages("mgcv")
setwd("~/Work/Projects/TannerCrab_SBS_SelectivityAnalysis/Analysis/SedimentAnalyses")
require(rgdal)
# The input file geodatabase
dsn <- "./SedimentsAnalysis.gdb"
#--check rgdal can handle gdb files
subset(ogrDrivers(), grepl("GDB", name))
#--list all feature classes in a file geodatabase
lyrs  <- ogrListLayers(dsn)
nlyrs <-length(fc_list)
print(lyrs);
if (nlyrs>0){
for (lyr in lyrs){
cat("Layer: '",lyr,"'\n",sep="")
lyrInfo<-rgdal::ogrInfo(dsn=dsn,layer=lyr);
print(lyrInfo);
}
}
nlyrs <-length(lyrs);
print(lyrs);
if (nlyrs>0){
for (lyr in lyrs){
cat("Layer: '",lyr,"'\n",sep="")
lyrInfo<-rgdal::ogrInfo(dsn=dsn,layer=lyr);
print(lyrInfo);
}
}
print(lyrs)
fc_CVR_DWB_MeanPhi <- sf::st_read(dsn, layer = "CVR_DWB_MeanPhi");
fc_CVR_EBK_MeanPhi <- sf::st_read(dsn, layer = "CVR_EBK_MeanPhi");
fc_CVR_DWB_Sorting <- sf::st_read(dsn, layer = "CVR_DWB_Sorting");
fc_CVR_EBK_Sorting <- sf::st_read(dsn, layer = "CVR_EBK_Sorting");
View(fc_CVR_DWB_MeanPhi)
qqplot(fc_CVR_DWB_MeanPhi$Measured,fc_CVR_DWB_MeanPhi$Predicted)
qqnorm(fc_CVR_DWB_MeanPhi$Error)
fc<-list();
fc[["CVR_DWB_MeanPhi"]] <- sf::st_read(dsn, layer = "CVR_DWB_MeanPhi");
fc[["CVR_EBK_MeanPhi"]] <- sf::st_read(dsn, layer = "CVR_EBK_MeanPhi");
fc[["CVR_DWB_Sorting"]] <- sf::st_read(dsn, layer = "CVR_DWB_Sorting");
fc[["CVR_EBK_Sorting"]] <- sf::st_read(dsn, layer = "CVR_EBK_Sorting");
plot(fc$CVR_DWB_MeanPhi[,"Error"])
nfc<-length(fc);
rms<-vector("numeric",nfc);
for (ifc in 1:nfc){
rms[ifc]<-sqrt(sum(fc[[ifc]]$Error^2)/(nrow(fc[[ifc]])-1));
}
dfr_stats<-data.frame(type=names(fc),rms=rms,stringsAsFactors = FALSE);
View(dfr_stats);
library(ggplot2)
require(ggplot2)
for (ifc in 1:nfc){
dfr<-fc[[ifc]];
p <-ggplot(dfr,mapping=aes(sample=Error));
p <- p + stat_qq() + stat_qq_line();
p <- p + labs(subtitle = names(fc)[ifc]);
print(p);
}
top<-"./Rasters";
fns<-c("MeanPhi_DWB_CrabSurveyArea1.tif")
rasters<-list();
for (fn in fns){
rasters[[fn]]<-stars::read_stars(file.path(top,fn));
}
plot(rasters[[1]])
fnp<-stringr::str_remove(fn,glob2rx(".tif"))
fnp<-stringr::str_remove(fn,(".tif"))
fns<-c("MeanPhi_DWB_CrabSurveyArea1.tif",
"MeanPhi_EBK_CrabSurveyArea1.tif",
"Sorting_DWB_CrabSurveyArea1.tif",
"Sorting_EBK_CrabSurveyArea1.tif");
rasters<-list();
for (fn in fns){
fnp<-stringr::str_remove(fn,(".tif"))
rasters[[fnp]]<-stars::read_stars(file.path(top,fn));
plot(rasters[[fnp]]);
}
rasters[[1]]
fns<-c("MeanPhi_DWB_CrabSurveyArea1.tif",
"MeanPhi_EBK_CrabSurveyArea1.tif",
"Sorting_DWB_CrabSurveyArea3.tif",
"Sorting_EBK_CrabSurveyArea1.tif");
rasters<-list();
for (fn in fns){
fnp<-stringr::str_remove(fn,(".tif"))
rasters[[fnp]]<-stars::read_stars(file.path(top,fn));
plot(rasters[[fnp]]);
}
#--get NMFS data
dirData_NMFS   <-"~/StockAssessments-Crab/Data/Survey.NMFS.EBS/Current";
fnStrata       <-file.path(dirData_NMFS,"TannerCrab_SurveyStrata.csv");
fnHaulData_NMFS<-file.path(dirData_NMFS,"TannerCrab_HaulData.csv");
#----read NMFS strata definitions
dfrStrata<-read.csv(fnStrata,check.names=FALSE,stringsAsFactors=FALSE)[,1:8];
dfrSD<-selectStrata.TrawlSurvey(dfrStrata,
species="BTC",
strataType="2015",
export=FALSE,
verbosity=verbosity);
#--read in NMFS haul data
dfrHaulData_NMFS<-read.csv(file=fnHaulData_NMFS,check.names=FALSE,stringsAsFactors=FALSE);
dfrHD_NMFS<-selectHauls.TrawlSurvey(dfrSD,
tbl=dfrHaulData_NMFS,
YearRange=c(minYr,maxYr),
export=FALSE,
verbosity=verbosity);
rm(dfrHaulData_NMFS,dfrStrata);
