source('~/Projects/TannerCrab_SBS_SelectivityAnalysis/SelectivityEstimation_Somerton/Somerton_Rfunction.R')
Survey.weighted.efficiency(sex);
source('~/Projects/TannerCrab_SBS_SelectivityAnalysis/SelectivityEstimation_Somerton/McConnaughey_opimodel.R')
pcapture.data.selectmodel.males<-read.csv("McConnaughey_data.csv",stringsAsFactors=FALSE,header=TRUE,skip=1);
View(pcapture.data.selectmodel.males)
dat <- pcapture.data.selectmodel.males
width <- dat$width
meas.b <- dat$meas.b
meas.n <- dat$meas.n
sed <- dat$phi
dep <- dat$depth
fit1 <- gam(cbind(meas.n, meas.b) ~ s(width) + s(sed, dep),
family = binomial)
print(summary(fit1))
cat("AIC=", AIC(fit1), "\n")
cat.b <- dat$num.b
cat.n <- dat$num.n
cat.b[cat.b == 0] <- 1
cat.n[cat.n == 0] <- 1
sp.b <- meas.b/cat.b
sp.n <- meas.n/cat.n
sp.b[sp.b == 0] <- 1
sp.n[sp.n == 0] <- 1
sam.rat <- sp.b/sp.n
area.b <- dat$area.b
area.n <- dat$area.n
a.rat <- area.b/area.n
ypred <- predict(fit1, type = "response")
ypredx <- tapply(ypred, width, mean)
y <- ypredx
ypredx
ypred
widths <- as.numeric(names(ypredx))
plot(widths, ypredx, ylim = c(0, 1), las = 1)
cat(widths, "\n")
a.rat.mean <- 0.144
sam.rat <- (sam.rat)^0.25
gfit <- gam(sam.rat ~ s(width))
s.pred <- predict.gam(gfit, newdata = data.frame(width = widths))
s.pred <- s.pred^4
plot(widths, s.pred)
p <- (y * s.pred * a.rat.mean)/(1 - y)
plot(widths, p, ylim = c(0, 1), las = 1, type = "l")
points(loglike.sol$width, loglike.sol$pcap, col = 5)
plot(widths, ypredx, ylim = c(0, 1), las = 1, lty=1, lwd=2, title="predicted response");
points(widths,meas.n/(meas.n+meas.b));
plot(widths, ypredx, ylim = c(0, 1), las = 1, lty=1, lwd=2);
points(widths,meas.n/(meas.n+meas.b));
title("predicted response");
points(width,meas.n/(meas.n+meas.b));
widths
ypredx
plot(widths, ypredx, ylim = c(0, 1), las = 1, lty=1, lwd=2);
plot(widths, ypredx, ylim = c(0, 1), las = 1, type="l", lty=1, lwd=2);
points(width,meas.n/(meas.n+meas.b));
title("predicted response");
mean(a.rat)
a.rat.mean <- mean(a.rat); #--was 0.144
sam.rat <- (sam.rat)^0.25; #--variance stabilization?
gfit <- gam(sam.rat ~ s(width))
s.pred <- predict.gam(gfit, newdata = data.frame(width = widths))
s.pred <- s.pred^4
plot(widths, s.pred);
points(width,sam.rat,alpha=0.5);
title("sampling ratio (BSFRF/NMFS)");
plot(widths, s.pred, type="l", lty=1, lwd=2);
points(width,sam.rat);
title("sampling ratio (BSFRF/NMFS)");
plot(widths, s.pred, type="l", lty=1, lwd=2);
points(width,sam.rat);
title("sampling ratio (BSFRF/NMFS)");
source('~/Projects/TannerCrab_SBS_SelectivityAnalysis/SelectivityEstimation_Somerton/McConnaughey_opimodel.R')
source('~/Projects/TannerCrab_SBS_SelectivityAnalysis/SelectivityEstimation_Somerton/McConnaughey_opimodel.R')
sex<-1;
survey2010.males.phi<-read.csv("Somerton_survey2010.males.phi.csv");
if(sex==1) dat1<-survey2010.males.phi
if(sex==2) dat1<-survey2010.females.phi
# get rid of the unmeasurable crabs
dat1<-dat1[!is.na(dat1$width),]
#
# constrain width to be a max of 125 so that size matches the prediction functions
#
dat1<-dat1[dat1$width>=20,]
if(sex==1) dat1$width[dat1$width>=125]<-125
if(sex==2) dat1$width[dat1$width>=75]<-75
phi<-dat1$phi
width<-dat1$width
width=trunc((width-1)/5)*5 + 3
area<-dat1$area
samp<-dat1$sampfac
station<-as.character(dat1$station)
dep<-dat1$depth
sed<-phi
indat<-data.frame(width,sed,dep)
if(sex==1) gam.object<-predict.gam.males.new
if(sex==2) gam.object<-predict.gam.females.new
pcap<-predict(gam.object, newdata=indat)
stat.area<-rep(400,length(station))
dat3<-strata.definitions.new
stationx<-as.character(dat3$station)
areax<-dat3$area
for (i in 1:length(areax)){
stat.area[station==stationx[i]]<-areax[i]
}
area.ratio<-stat.area/area
